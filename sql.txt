CREATE PROCEDURE [dbo].[UspItemTranscation]     @i_charId INT   , @i_baseTable [TvpItem] READONLY   , @i_delete [TvpItemDelete] READONLY   , @i_wShopJop    TINYINT   , @i_wShopJobID    BIGINT  AS  BEGIN     SET NOCOUNT ON   SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED     --===============================================================================================   -- 데이터 세팅.   --===============================================================================================     DECLARE      @PROC_NONE  TINYINT = 0    , @PROC_INSERT TINYINT = 1     , @PROC_DELETE TINYINT = 2    , @PROC_UPDATE TINYINT = 3      , @WSHOP_INSERT TINYINT = 0    , @WSHOP_UPDATE TINYINT = 1    , @WSHOP_DELETE TINYINT = 2      , @action_none TINYINT  = 0    , @action_push TINYINT  = 1  -- 기사단 창고에 넣기    , @action_pop  TINYINT  = 2  -- 기사단 창고에서 빼기    , @action_update TINYINT  = 3  -- 기사단 창고에서 수량 업데이트    , @action_delete TINYINT  = 4  -- 기사단 창고에서 삭제         DECLARE @tblItem_insUpdate   TABLE(actionType TINYINT, itemIndex INT, itemId BIGINT, affectedOverlap SMALLINT, invokedKnightageid INT)   DECLARE @tblItem_deleted   TABLE(actionType TINYINT, itemIndex INT, itemId BIGINT, affectedOverlap SMALLINT, invokedKnightageid INT)   DECLARE @tblItem_changeOwner  TABLE(actionType TINYINT, itemIndex INT, itemId BIGINT, affectedOverlap SMALLINT, invokedKnightageid INT)   DECLARE @tblItem_withKnightage  TABLE(actionType TINYINT, itemIndex INT, itemId BIGINT, affectedOverlap SMALLINT, invokedKnightageid INT)     DECLARE @deleteCount INT   SELECT @deleteCount = COUNT(*) FROM @i_delete     --===============================================================================================   -- WShop이 활성화인경우 현제 데이터 값들 백업   --===============================================================================================     IF @i_wShopJop = 1   BEGIN    INSERT INTO dbo.TblWShopDetailGameItem (       jobNo     , worktype     , ItemId     , [type]     , accountGuid     , charid     , inventory     , slot     , overlap     , magicBook     , magicSocketCount     , magicSocket1, magicSocket2, magicSocket3, magicSocket4, magicSocket5     , skillId     , identifyOption       , optionSelectCount0, optionMaxSelectCount0, optiontype0, optionvalue0, optionpercent0,optiondata0     , optionSelectCount1, optionMaxSelectCount1, optiontype1, optionvalue1, optionpercent1,optiondata1     , optionSelectCount2, optionMaxSelectCount2, optiontype2, optionvalue2, optionpercent2,optiondata2     , optionSelectCount3, optionMaxSelectCount3, optiontype3, optionvalue3, optionpercent3,optiondata3     , optionSelectCount4, optionMaxSelectCount4, optiontype4, optionvalue4, optionpercent4,optiondata4     , optionSelectCount5, optionMaxSelectCount5, optiontype5, optionvalue5, optionpercent5,optiondata5     , optionSelectCount6, optionMaxSelectCount6, optiontype6, optionvalue6, optionpercent6,optiondata6     , optionSelectCount7, optionMaxSelectCount7, optiontype7, optionvalue7, optionpercent7,optiondata7     , optionSelectCount8, optionMaxSelectCount8, optiontype8, optionvalue8, optionpercent8,optiondata8     , optionSelectCount9, optionMaxSelectCount9, optiontype9, optionvalue9, optionpercent9,optiondata9     , optionSelectCount10, optionMaxSelectCount10, optiontype10, optionvalue10, optionpercent10,optiondata10     , optionSelectCount11, optionMaxSelectCount11, optiontype11, optionvalue11, optionpercent11,optiondata11     , optionSelectCount12, optionMaxSelectCount12, optiontype12, optionvalue12, optionpercent12,optiondata12     , optionSelectCount13, optionMaxSelectCount13, optiontype13, optionvalue13, optionpercent13,optiondata13     , optionSelectCount14, optionMaxSelectCount14, optiontype14, optionvalue14, optionpercent14,optiondata14     , optionSelectCount15, optionMaxSelectCount15, optiontype15, optionvalue15, optionpercent15,optiondata15     , optionSelectCount16, optionMaxSelectCount16, optiontype16, optionvalue16, optionpercent16,optiondata16     , optionSelectCount17, optionMaxSelectCount17, optiontype17, optionvalue17, optionpercent17,optiondata17     , optionSelectCount18, optionMaxSelectCount18, optiontype18, optionvalue18, optionpercent18,optiondata18     , optionSelectCount19, optionMaxSelectCount19, optiontype19, optionvalue19, optionpercent19,optiondata19       , enchant     , prePositionWord     , [time]     , curDurability, maxDurability     , bindItemCharId, isSealedItem, sealcount     , expirationDate, add_minute     , variationIndex     , customItemIndex, customPrepositionword, customVariationIndex, customArmorIndex, customWeaponIndex     , knightageid     , growExp     , changedOptionType, changedOptionSection     , additionalOptionGrade     , additionalOptionindex0, additionalOptiontype0, additionalOptionvalue0, additionalOptionpercent0     , additionalOptionindex1, additionalOptiontype1, additionalOptionvalue1, additionalOptionpercent1     , additionalOptionindex2, additionalOptiontype2, additionalOptionvalue2, additionalOptionpercent2     , transcendItemIndex0, transcendEnchantCount0, transcendEnchantFailCount0, transcendOptiontype0, transcendOptionvalue0, transcendOptionpercent0     , transcendItemIndex1, transcendEnchantCount1, transcendEnchantFailCount1, transcendOptiontype1, transcendOptionvalue1, transcendOptionpercent1     , [Block]     , [enchantFailCount]     , optionChangeCount     , transcendStoneResetCount     , itemRuneMainIndex, itemRuneOptionType, itemRuneOptionValue, itemRuneOptionPercent      )    SELECT       @i_wShopJobID     , worktype     , S.ItemId     , IsNULL(T.[type], 0)     , ISNULL(S.inserterAccountId, T.accountguid)     , ISNULL(S.inserterCharId, T.charid)         , IsNULL(T.inventory,0)     , IsNULL(T.slot,0)     , IsNULL(T.overlap,0)     , IsNULL(T.magicBook,0)     , IsNULL(T.magicSocketCount,0)     , IsNULL(T.magicSocket1,0), IsNULL(T.magicSocket2,0), IsNULL(T.magicSocket3,0), IsNULL(T.magicSocket4,0), IsNULL(T.magicSocket5,0)     , IsNULL(T.skillId,0)     , IsNULL(T.identifyOption,0)     , IsNULL(T.optionSelectCount0,0), IsNULL(T.optionMaxSelectCount0,0), IsNULL(T.optiontype0,N''), IsNULL(T.optionvalue0,0), IsNULL(T.optionpercent0,0), ISNULL(T.optiondata0, 0)     , IsNULL(T.optionSelectCount1,0), IsNULL(T.optionMaxSelectCount1,0), IsNULL(T.optiontype1,N''), IsNULL(T.optionvalue1,0), IsNULL(T.optionpercent1,0), ISNULL(T.optiondata1, 0)     , IsNULL(T.optionSelectCount2,0), IsNULL(T.optionMaxSelectCount2,0), IsNULL(T.optiontype2,N''), IsNULL(T.optionvalue2,0), IsNULL(T.optionpercent2,0), ISNULL(T.optiondata2, 0)     , IsNULL(T.optionSelectCount3,0), IsNULL(T.optionMaxSelectCount3,0), IsNULL(T.optiontype3,N''), IsNULL(T.optionvalue3,0), IsNULL(T.optionpercent3,0), ISNULL(T.optiondata3, 0)     , IsNULL(T.optionSelectCount4,0), IsNULL(T.optionMaxSelectCount4,0), IsNULL(T.optiontype4,N''), IsNULL(T.optionvalue4,0), IsNULL(T.optionpercent4,0), ISNULL(T.optiondata4, 0)     , IsNULL(T.optionSelectCount5,0), IsNULL(T.optionMaxSelectCount5,0), IsNULL(T.optiontype5,N''), IsNULL(T.optionvalue5,0), IsNULL(T.optionpercent5,0), ISNULL(T.optiondata5, 0)     , IsNULL(T.optionSelectCount6,0), IsNULL(T.optionMaxSelectCount6,0), IsNULL(T.optiontype6,N''), IsNULL(T.optionvalue6,0), IsNULL(T.optionpercent6,0), ISNULL(T.optiondata6, 0)     , IsNULL(T.optionSelectCount7,0), IsNULL(T.optionMaxSelectCount7,0), IsNULL(T.optiontype7,N''), IsNULL(T.optionvalue7,0), IsNULL(T.optionpercent7,0), ISNULL(T.optiondata7, 0)     , IsNULL(T.optionSelectCount8,0), IsNULL(T.optionMaxSelectCount8,0), IsNULL(T.optiontype8,N''), IsNULL(T.optionvalue8,0), IsNULL(T.optionpercent8,0), ISNULL(T.optiondata8, 0)     , IsNULL(T.optionSelectCount9,0),  IsNULL(T.optionMaxSelectCount9,0),  IsNULL(T.optiontype9,N''),  IsNULL(T.optionvalue9,0),  IsNULL(T.optionpercent9,0), ISNULL(T.optiondata9, 0)     , IsNULL(T.optionSelectCount10,0), IsNULL(T.optionMaxSelectCount10,0), IsNULL(T.optiontype10,N''), IsNULL(T.optionvalue10,0), IsNULL(T.optionpercent10,0), ISNULL(T.optiondata10, 0)     , IsNULL(T.optionSelectCount11,0), IsNULL(T.optionMaxSelectCount11,0), IsNULL(T.optiontype11,N''), IsNULL(T.optionvalue11,0), IsNULL(T.optionpercent11,0), ISNULL(T.optiondata11, 0)     , IsNULL(T.optionSelectCount12,0), IsNULL(T.optionMaxSelectCount12,0), IsNULL(T.optiontype12,N''), IsNULL(T.optionvalue12,0), IsNULL(T.optionpercent12,0), ISNULL(T.optiondata12, 0)     , IsNULL(T.optionSelectCount13,0), IsNULL(T.optionMaxSelectCount13,0), IsNULL(T.optiontype13,N''), IsNULL(T.optionvalue13,0), IsNULL(T.optionpercent13,0), ISNULL(T.optiondata13, 0)     , IsNULL(T.optionSelectCount14,0), IsNULL(T.optionMaxSelectCount14,0), IsNULL(T.optiontype14,N''), IsNULL(T.optionvalue14,0), IsNULL(T.optionpercent14,0), ISNULL(T.optiondata14, 0)     , IsNULL(T.optionSelectCount15,0), IsNULL(T.optionMaxSelectCount15,0), IsNULL(T.optiontype15,N''), IsNULL(T.optionvalue15,0), IsNULL(T.optionpercent15,0), ISNULL(T.optiondata15, 0)     , IsNULL(T.optionSelectCount16,0), IsNULL(T.optionMaxSelectCount16,0), IsNULL(T.optiontype16,N''), IsNULL(T.optionvalue16,0), IsNULL(T.optionpercent16,0), ISNULL(T.optiondata16, 0)     , IsNULL(T.optionSelectCount17,0), IsNULL(T.optionMaxSelectCount17,0), IsNULL(T.optiontype17,N''), IsNULL(T.optionvalue17,0), IsNULL(T.optionpercent17,0), ISNULL(T.optiondata17, 0)     , IsNULL(T.optionSelectCount18,0), IsNULL(T.optionMaxSelectCount18,0), IsNULL(T.optiontype18,N''), IsNULL(T.optionvalue18,0), IsNULL(T.optionpercent18,0), ISNULL(T.optiondata18, 0)     , IsNULL(T.optionSelectCount19,0), IsNULL(T.optionMaxSelectCount19,0), IsNULL(T.optiontype19,N''), IsNULL(T.optionvalue19,0), IsNULL(T.optionpercent19,0), ISNULL(T.optiondata19, 0)         , IsNULL(T.enchant,0)     , IsNULL(T.prePositionWord,0)     , IsNULL(T.[time],0)     , IsNULL(T.curDurability,0), IsNULL(T.maxDurability,0)     , IsNULL(T.bindItemCharId,0), IsNULL(T.isSealedItem,0), IsNULL(T.sealcount,0)     , IsNULL(T.expirationDate, dbo.fnMinDate()), IsNULL(T.add_minute,0)     , IsNULL(T.variationIndex,0)     , IsNULL(T.customItemIndex,0), IsNULL(T.customPrepositionword,0), IsNULL(T.customVariationIndex,0), IsNULL(T.customArmorIndex,0), IsNULL(T.customWeaponIndex,0)     , IsNULL(T.knightageid,0)     , IsNULL(T.growExp,0)     , IsNULL(T.changedOptionType,''), IsNULL(T.changedOptionSection,0)     , IsNULL(T.additionalOptionGrade,0)     , IsNULL(T.additionalOptionindex0,0), IsNULL(T.additionalOptiontype0,N''), IsNULL(T.additionalOptionvalue0,0), IsNULL(T.additionalOptionpercent0,0)     , IsNULL(T.additionalOptionindex1,0), IsNULL(T.additionalOptiontype1,N''), IsNULL(T.additionalOptionvalue1,0), IsNULL(T.additionalOptionpercent1,0)     , IsNULL(T.additionalOptionindex2,0), IsNULL(T.additionalOptiontype2,N''), IsNULL(T.additionalOptionvalue2,0), IsNULL(T.additionalOptionpercent2,0)     , IsNULL(T.transcendItemIndex0,0), IsNULL(T.transcendEnchantCount0,0), IsNULL(T.transcendEnchantFailCount0,0), IsNULL(T.transcendOptiontype0,N''), IsNULL(T.transcendOptionvalue0,0), IsNULL(T.transcendOptionpercent0,0)     , IsNULL(T.transcendItemIndex1,0), IsNULL(T.transcendEnchantCount1,0), IsNULL(T.transcendEnchantFailCount1,0), IsNULL(T.transcendOptiontype1,N''), IsNULL(T.transcendOptionvalue1,0), IsNULL(T.transcendOptionpercent1,0)     , IsNULL(T.[Block],0)      , IsNULL(T.[enchantFailCount],0)     , IsNULL(T.optionChangeCount,0)     , IsNULL(T.transcendStoneResetCount, 0)     , IsNULL(T.itemRuneMainIndex,0), IsNULL(T.itemRuneOptionType,0), IsNULL(T.itemRuneOptionValue,0), IsNULL(T.itemRuneOptionPercent,'')    FROM (         SELECT itemId         , @WSHOP_DELETE AS worktype         , NULL   AS inserterCharId         , NULL   AS inserterAccountId        FROM @i_delete        UNION ALL        SELECT itemId         , CASE WHEN JobType = @PROC_INSERT THEN @WSHOP_INSERT            WHEN JobType = @PROC_UPDATE THEN @WSHOP_UPDATE          END  AS worktype         , CASE WHEN JobType = @PROC_INSERT THEN charid ELSE NULL END AS inserterCharId         , CASE WHEN JobType = @PROC_INSERT THEN accountguid ELSE NULL END AS inserterAccountId        FROM @i_baseTable      )S      LEFT JOIN dbo.TblItem T ON S.itemId = T.itemid     END     --===============================================================================================   -- 우선 기존 아이템 삭제.   --===============================================================================================      DELETE T1    OUTPUT      CASE WHEN DELETED.knightageid != 0 THEN @action_delete ELSE @action_none END    , DELETED.type    , DELETED.itemid    , CASE WHEN DELETED.knightageid != 0 THEN DELETED.overlap ELSE 0 END      , DELETED.knightageid   INTO @tblItem_deleted(actionType, itemIndex, itemId, affectedOverlap, invokedKnightageid)   FROM dbo.TblItem T1     INNER JOIN @i_delete T2 ON  T1.ItemId = T2.ItemId     --===============================================================================================   -- 갯수가 동일 하지 않다면 오류.    --===============================================================================================     IF (@@ROWCOUNT <> @deleteCount )   BEGIN    RETURN (255)   END      --===============================================================================================   -- Insert 데이터 중복 체크.   --===============================================================================================     IF EXISTS ( SELECT * From dbo.TblItem T1     INNER JOIN @i_baseTable T2     ON T1.charid = T2.charid    WHERE T2.inventory < 200 and  T1.inventory = T2.inventory and T1.slot = T2.slot AND T2.JobType = @PROC_INSERT )   BEGIN    RETURN 1001   END     MERGE dbo.TblItem T    USING (       SELECT * FROM @i_baseTable      )AS S       ON  T.itemId = S.ItemId   WHEN NOT MATCHED THEN    INSERT ( ItemId      , [type]      , accountGuid      , charid      , inventory      , slot      , overlap      , magicBook      , magicSocketCount      , magicSocket1, magicSocket2, magicSocket3, magicSocket4, magicSocket5      , skillId      , identifyOption       , optionSelectCount0, optionMaxSelectCount0, optiontype0, optionvalue0, optionpercent0,optiondata0     , optionSelectCount1, optionMaxSelectCount1, optiontype1, optionvalue1, optionpercent1,optiondata1     , optionSelectCount2, optionMaxSelectCount2, optiontype2, optionvalue2, optionpercent2,optiondata2     , optionSelectCount3, optionMaxSelectCount3, optiontype3, optionvalue3, optionpercent3,optiondata3     , optionSelectCount4, optionMaxSelectCount4, optiontype4, optionvalue4, optionpercent4,optiondata4     , optionSelectCount5, optionMaxSelectCount5, optiontype5, optionvalue5, optionpercent5,optiondata5     , optionSelectCount6, optionMaxSelectCount6, optiontype6, optionvalue6, optionpercent6,optiondata6     , optionSelectCount7, optionMaxSelectCount7, optiontype7, optionvalue7, optionpercent7,optiondata7     , optionSelectCount8, optionMaxSelectCount8, optiontype8, optionvalue8, optionpercent8,optiondata8     , optionSelectCount9, optionMaxSelectCount9, optiontype9, optionvalue9, optionpercent9,optiondata9     , optionSelectCount10, optionMaxSelectCount10, optiontype10, optionvalue10, optionpercent10,optiondata10     , optionSelectCount11, optionMaxSelectCount11, optiontype11, optionvalue11, optionpercent11,optiondata11     , optionSelectCount12, optionMaxSelectCount12, optiontype12, optionvalue12, optionpercent12,optiondata12     , optionSelectCount13, optionMaxSelectCount13, optiontype13, optionvalue13, optionpercent13,optiondata13     , optionSelectCount14, optionMaxSelectCount14, optiontype14, optionvalue14, optionpercent14,optiondata14     , optionSelectCount15, optionMaxSelectCount15, optiontype15, optionvalue15, optionpercent15,optiondata15     , optionSelectCount16, optionMaxSelectCount16, optiontype16, optionvalue16, optionpercent16,optiondata16     , optionSelectCount17, optionMaxSelectCount17, optiontype17, optionvalue17, optionpercent17,optiondata17     , optionSelectCount18, optionMaxSelectCount18, optiontype18, optionvalue18, optionpercent18,optiondata18     , optionSelectCount19, optionMaxSelectCount19, optiontype19, optionvalue19, optionpercent19,optiondata19        , enchant      , prePositionWord      , [time]      , curDurability, maxDurability      , bindItemCharId, isSealedItem, sealcount      , expirationDate, add_minute      , variationIndex      , customItemIndex, customPrepositionword, customVariationIndex, customArmorIndex, customWeaponIndex      , knightageid      , growExp      , changedOptionType, changedOptionSection      , additionalOptionGrade      , additionalOptionindex0, additionalOptiontype0, additionalOptionvalue0, additionalOptionpercent0      , additionalOptionindex1, additionalOptiontype1, additionalOptionvalue1, additionalOptionpercent1      , additionalOptionindex2, additionalOptiontype2, additionalOptionvalue2, additionalOptionpercent2      , transcendItemIndex0, transcendEnchantCount0, transcendEnchantFailCount0, transcendOptiontype0, transcendOptionvalue0, transcendOptionpercent0      , transcendItemIndex1, transcendEnchantCount1, transcendEnchantFailCount1, transcendOptiontype1, transcendOptionvalue1, transcendOptionpercent1      , enchantFailCount      , optionChangeCount      , transcendStoneResetCount      , itemRuneMainIndex, itemRuneOptionType, itemRuneOptionValue, itemRuneOptionPercent)    VALUES ( S.ItemId      , S.[type]      , S.accountGuid      , S.charid      , S.inventory      , S.slot      , S.overlap      , S.magicBook      , S.magicSocketCount      , S.magicSocket1, S.magicSocket2, S.magicSocket3, S.magicSocket4, S.magicSocket5      , S.skillId      , S.identifyOption      , S.optionSelectCount0, S.optionMaxSelectCount0, S.optiontype0, S.optionvalue0, S.optionpercent0, S.optiondata0      , S.optionSelectCount1, S.optionMaxSelectCount1, S.optiontype1, S.optionvalue1, S.optionpercent1, S.optiondata1      , S.optionSelectCount2, S.optionMaxSelectCount2, S.optiontype2, S.optionvalue2, S.optionpercent2, S.optiondata2      , S.optionSelectCount3, S.optionMaxSelectCount3, S.optiontype3, S.optionvalue3, S.optionpercent3, S.optiondata3      , S.optionSelectCount4, S.optionMaxSelectCount4, S.optiontype4, S.optionvalue4, S.optionpercent4, S.optiondata4      , S.optionSelectCount5, S.optionMaxSelectCount5, S.optiontype5, S.optionvalue5, S.optionpercent5, S.optiondata5      , S.optionSelectCount6, S.optionMaxSelectCount6, S.optiontype6, S.optionvalue6, S.optionpercent6, S.optiondata6      , S.optionSelectCount7, S.optionMaxSelectCount7, S.optiontype7, S.optionvalue7, S.optionpercent7, S.optiondata7      , S.optionSelectCount8, S.optionMaxSelectCount8, S.optiontype8, S.optionvalue8, S.optionpercent8, S.optiondata8      , S.optionSelectCount9, S.optionMaxSelectCount9, S.optiontype9, S.optionvalue9, S.optionpercent9, S.optiondata9      , S.optionSelectCount10, S.optionMaxSelectCount10, S.optiontype10, S.optionvalue10, S.optionpercent10, S.optiondata10      , S.optionSelectCount11, S.optionMaxSelectCount11, S.optiontype11, S.optionvalue11, S.optionpercent11, S.optiondata11      , S.optionSelectCount12, S.optionMaxSelectCount12, S.optiontype12, S.optionvalue12, S.optionpercent12, S.optiondata12      , S.optionSelectCount13, S.optionMaxSelectCount13, S.optiontype13, S.optionvalue13, S.optionpercent13, S.optiondata13      , S.optionSelectCount14, S.optionMaxSelectCount14, S.optiontype14, S.optionvalue14, S.optionpercent14, S.optiondata14      , S.optionSelectCount15, S.optionMaxSelectCount15, S.optiontype15, S.optionvalue15, S.optionpercent15, S.optiondata15      , S.optionSelectCount16, S.optionMaxSelectCount16, S.optiontype16, S.optionvalue16, S.optionpercent16, S.optiondata16      , S.optionSelectCount17, S.optionMaxSelectCount17, S.optiontype17, S.optionvalue17, S.optionpercent17, S.optiondata17      , S.optionSelectCount18, S.optionMaxSelectCount18, S.optiontype18, S.optionvalue18, S.optionpercent18, S.optiondata18      , S.optionSelectCount19, S.optionMaxSelectCount19, S.optiontype19, S.optionvalue19, S.optionpercent19, S.optiondata19          , S.enchant      , S.prePositionWord      , S.[time]      , S.curDurability, S.maxDurability      , S.bindItemCharId, S.isSealedItem, S.sealcount      , S.expirationDate, S.add_minute      , S.variationIndex      , S.customItemIndex, S.customPrepositionword, S.customVariationIndex, S.customArmorIndex, S.customWeaponIndex      , S.knightageid      , S.growExp      , S.changedOptionType, S.changedOptionSection      , S.additionalOptionGrade      , S.additionalOptionindex0, S.additionalOptiontype0, S.additionalOptionvalue0, S.additionalOptionpercent0      , S.additionalOptionindex1, S.additionalOptiontype1, S.additionalOptionvalue1, S.additionalOptionpercent1      , S.additionalOptionindex2, S.additionalOptiontype2, S.additionalOptionvalue2, S.additionalOptionpercent2      , S.transcendItemIndex0, S.transcendEnchantCount0, S.transcendEnchantFailCount0, S.transcendOptiontype0, S.transcendOptionvalue0, S.transcendOptionpercent0      , S.transcendItemIndex1, S.transcendEnchantCount1, S.transcendEnchantFailCount1, S.transcendOptiontype1, S.transcendOptionvalue1, S.transcendOptionpercent1      , S.enchantFailCount      , S.optionChangeCount      , S.transcendStoneResetCount      , S.itemRuneMainIndex, S.itemRuneOptionType, S.itemRuneOptionValue, S.itemRuneOptionPercent)   WHEN MATCHED AND S.JobType = @PROC_UPDATE AND (S.charid = T.charid and S.knightageid = T.knightageid) THEN   UPDATE  SET         [type]      = S.[type]     , inventory     = S.inventory      , slot      = S.slot        , overlap     = S.overlap     , magicBook     = S.magicBook     , magicSocketCount   = S.magicSocketCount     , magicSocket1    = S.magicSocket1, magicSocket2 = S.magicSocket2, magicSocket3 = S.magicSocket3, magicSocket4 = S.magicSocket4, magicSocket5 = S.magicSocket5      , skillId     = S.skillId     , identifyOption   = S.identifyOption     , optiontype0    = S.optiontype0, optionvalue0 = S.optionvalue0, optionpercent0 = S.optionpercent0, optiondata0 = S.optiondata0     , optiontype1    = S.optiontype1, optionvalue1 = S.optionvalue1, optionpercent1 = S.optionpercent1, optiondata1 = S.optiondata1     , optiontype2    = S.optiontype2, optionvalue2 = S.optionvalue2, optionpercent2 = S.optionpercent2, optiondata2 = S.optiondata2     , optiontype3    = S.optiontype3, optionvalue3 = S.optionvalue3, optionpercent3 = S.optionpercent3, optiondata3 = S.optiondata3     , optiontype4    = S.optiontype4, optionvalue4 = S.optionvalue4, optionpercent4 = S.optionpercent4, optiondata4 = S.optiondata4     , optiontype5    = S.optiontype5, optionvalue5 = S.optionvalue5, optionpercent5 = S.optionpercent5, optiondata5 = S.optiondata5     , optiontype6    = S.optiontype6, optionvalue6 = S.optionvalue6, optionpercent6 = S.optionpercent6, optiondata6 = S.optiondata6     , optiontype7    = S.optiontype7, optionvalue7 = S.optionvalue7, optionpercent7 = S.optionpercent7, optiondata7 = S.optiondata7     , optiontype8    = S.optiontype8, optionvalue8 = S.optionvalue8, optionpercent8 = S.optionpercent8, optiondata8 = S.optiondata8     , optiontype9    = S.optiontype9, optionvalue9 = S.optionvalue9, optionpercent9 = S.optionpercent9, optiondata9 = S.optiondata9     , optiontype10    = S.optiontype10, optionvalue10 = S.optionvalue10, optionpercent10 = S.optionpercent10, optiondata10 = S.optiondata10     , optiontype11    = S.optiontype11, optionvalue11 = S.optionvalue11, optionpercent11 = S.optionpercent11, optiondata11 = S.optiondata11     , optiontype12    = S.optiontype12, optionvalue12 = S.optionvalue12, optionpercent12 = S.optionpercent12, optiondata12 = S.optiondata12     , optiontype13    = S.optiontype13, optionvalue13 = S.optionvalue13, optionpercent13 = S.optionpercent13, optiondata13 = S.optiondata13     , optiontype14    = S.optiontype14, optionvalue14 = S.optionvalue14, optionpercent14 = S.optionpercent14, optiondata14 = S.optiondata14     , optiontype15    = S.optiontype15, optionvalue15 = S.optionvalue15, optionpercent15 = S.optionpercent15, optiondata15 = S.optiondata15     , optiontype16    = S.optiontype16, optionvalue16 = S.optionvalue16, optionpercent16 = S.optionpercent16, optiondata16 = S.optiondata16     , optiontype17    = S.optiontype17, optionvalue17 = S.optionvalue17, optionpercent17 = S.optionpercent17, optiondata17 = S.optiondata17     , optiontype18    = S.optiontype18, optionvalue18 = S.optionvalue18, optionpercent18 = S.optionpercent18, optiondata18 = S.optiondata18     , optiontype19    = S.optiontype19, optionvalue19 = S.optionvalue19, optionpercent19 = S.optionpercent19, optiondata19 = S.optiondata19           , enchant     = S.enchant     , prePositionWord   = S.prepositionword     , [time]     = S.[time]     , curDurability    = S.curDurability, maxDurability = S.maxDurability     , bindItemCharId   = S.bindItemCharId, isSealedItem = S.isSealedItem, sealcount = S.sealCount     , expirationDate   = S.expirationdate, add_minute = S.add_minute     , variationIndex   = S.variationIndex     , customItemIndex   = S.customItemIndex, customPrepositionword = S.customPrepositionword, customVariationIndex = S.customVariationIndex, customArmorIndex = S.customArmorIndex, customWeaponIndex = S.customWeaponIndex     , growExp     = S.growExp     , changedOptionType   = S.changedOptionType, changedOptionSection = S.changedOptionSection     , additionalOptionGrade  = S.additionalOptionGrade     , additionalOptionIndex0 = S.additionalOptionIndex0, additionalOptiontype0 = S.additionalOptionType0, additionalOptionvalue0 = S.additionalOptionValue0, additionalOptionpercent0 = S.additionalOptionPercent0     , additionalOptionIndex1 = S.additionalOptionIndex1, additionalOptiontype1 = S.additionalOptionType1, additionalOptionvalue1 = S.additionalOptionValue1, additionalOptionpercent1 = S.additionalOptionPercent1     , additionalOptionIndex2 = S.additionalOptionIndex2, additionalOptiontype2 = S.additionalOptionType2, additionalOptionvalue2 = S.additionalOptionValue2, additionalOptionpercent2 = S.additionalOptionPercent2     , transcendItemIndex0  = S.transcendItemIndex0, transcendEnchantCount0 = S.transcendEnchantCount0, transcendEnchantFailCount0 = S.transcendEnchantFailCount0, transcendOptiontype0  = S.transcendOptiontype0     , transcendOptionvalue0  = S.transcendOptionvalue0, transcendOptionpercent0 = S.transcendOptionpercent0     , transcendItemIndex1  = S.transcendItemIndex1, transcendEnchantCount1 = S.transcendEnchantCount1, transcendEnchantFailCount1 = S.transcendEnchantFailCount1, transcendOptiontype1  = S.transcendOptiontype1     , transcendOptionvalue1  = S.transcendOptionvalue1, transcendOptionpercent1 = S.transcendOptionpercent1     , enchantFailCount   = S.enchantFailCount     , optionChangeCount   = S.optionChangeCount     , transcendStoneResetCount  = S.transcendStoneResetCount     , itemRuneMainIndex   = S.itemRuneMainIndex, itemRuneOptionType = S.itemRuneOptionType     , itemRuneOptionValue  = S.itemRuneOptionValue, itemRuneOptionPercent = S.itemRuneOptionPercent     , optionSelectCount0  = S.optionSelectCount0, optionMaxSelectCount0 = S.optionMaxSelectCount0     , optionSelectCount1  = S.optionSelectCount1, optionMaxSelectCount1 = S.optionMaxSelectCount1     , optionSelectCount2  = S.optionSelectCount2, optionMaxSelectCount2 = S.optionMaxSelectCount2     , optionSelectCount3  = S.optionSelectCount3, optionMaxSelectCount3 = S.optionMaxSelectCount3     , optionSelectCount4  = S.optionSelectCount4, optionMaxSelectCount4 = S.optionMaxSelectCount4     , optionSelectCount5  = S.optionSelectCount5, optionMaxSelectCount5 = S.optionMaxSelectCount5     , optionSelectCount6  = S.optionSelectCount6, optionMaxSelectCount6 = S.optionMaxSelectCount6     , optionSelectCount7  = S.optionSelectCount7, optionMaxSelectCount7 = S.optionMaxSelectCount7     , optionSelectCount8  = S.optionSelectCount8, optionMaxSelectCount8 = S.optionMaxSelectCount8     , optionSelectCount9  = S.optionSelectCount9, optionMaxSelectCount9 = S.optionMaxSelectCount9     , optionSelectCount10  = S.optionSelectCount10, optionMaxSelectCount10 = S.optionMaxSelectCount10     , optionSelectCount11  = S.optionSelectCount11, optionMaxSelectCount11 = S.optionMaxSelectCount11     , optionSelectCount12  = S.optionSelectCount12, optionMaxSelectCount12 = S.optionMaxSelectCount12     , optionSelectCount13  = S.optionSelectCount13, optionMaxSelectCount13 = S.optionMaxSelectCount13     , optionSelectCount14  = S.optionSelectCount14, optionMaxSelectCount14 = S.optionMaxSelectCount14     , optionSelectCount15  = S.optionSelectCount15, optionMaxSelectCount15 = S.optionMaxSelectCount15     , optionSelectCount16  = S.optionSelectCount16, optionMaxSelectCount16 = S.optionMaxSelectCount16     , optionSelectCount17  = S.optionSelectCount17, optionMaxSelectCount17 = S.optionMaxSelectCount17     , optionSelectCount18  = S.optionSelectCount18, optionMaxSelectCount18 = S.optionMaxSelectCount18     , optionSelectCount19  = S.optionSelectCount19, optionMaxSelectCount19 = S.optionMaxSelectCount19     OUTPUT  CASE WHEN DELETED.knightageid != 0 AND INSERTED.knightageid != 0 AND DELETED.overlap != INSERTED.overlap THEN @action_update ELSE @action_none END     , INSERTED.type     , INSERTED.itemid     , CASE WHEN DELETED.knightageid != 0 AND INSERTED.knightageid != 0 AND DELETED.overlap != INSERTED.overlap THEN INSERTED.overlap - DELETED.overlap ELSE 0 END     , CASE WHEN DELETED.knightageid != 0 THEN DELETED.knightageid ELSE INSERTED.knightageid END   INTO  @tblItem_insUpdate(actionType, itemIndex, itemId, affectedOverlap, invokedKnightageid);         UPDATE T   SET       charid      = S.charid       , knightageid    = S.knightageid     , [type]     = S.[type]     , accountGuid    = S.accountGuid     , inventory     = S.inventory      , slot      = S.slot        , overlap     = S.overlap     , magicBook     = S.magicBook     , magicSocketCount   = S.magicSocketCount     , magicSocket1    = S.magicSocket1, magicSocket2 = S.magicSocket2, magicSocket3 = S.magicSocket3, magicSocket4 = S.magicSocket4, magicSocket5 = S.magicSocket5      , skillId     = S.skillId     , identifyOption   = S.identifyOption     , optiontype0    = S.optiontype0, optionvalue0 = S.optionvalue0, optionpercent0 = S.optionpercent0, optiondata0 = S.optiondata0     , optiontype1    = S.optiontype1, optionvalue1 = S.optionvalue1, optionpercent1 = S.optionpercent1, optiondata1 = S.optiondata1     , optiontype2    = S.optiontype2, optionvalue2 = S.optionvalue2, optionpercent2 = S.optionpercent2, optiondata2 = S.optiondata2     , optiontype3    = S.optiontype3, optionvalue3 = S.optionvalue3, optionpercent3 = S.optionpercent3, optiondata3 = S.optiondata3     , optiontype4    = S.optiontype4, optionvalue4 = S.optionvalue4, optionpercent4 = S.optionpercent4, optiondata4 = S.optiondata4     , optiontype5    = S.optiontype5, optionvalue5 = S.optionvalue5, optionpercent5 = S.optionpercent5, optiondata5 = S.optiondata5     , optiontype6    = S.optiontype6, optionvalue6 = S.optionvalue6, optionpercent6 = S.optionpercent6, optiondata6 = S.optiondata6     , optiontype7    = S.optiontype7, optionvalue7 = S.optionvalue7, optionpercent7 = S.optionpercent7, optiondata7 = S.optiondata7     , optiontype8    = S.optiontype8, optionvalue8 = S.optionvalue8, optionpercent8 = S.optionpercent8, optiondata8 = S.optiondata8     , optiontype9    = S.optiontype9, optionvalue9 = S.optionvalue9, optionpercent9 = S.optionpercent9, optiondata9 = S.optiondata9     , optiontype10   = S.optiontype10,optionvalue10 =S.optionvalue10,optionpercent10 =S.optionpercent10, optiondata10 = S.optiondata10     , optiontype11    = S.optiontype11, optionvalue11 = S.optionvalue11, optionpercent11 = S.optionpercent11, optiondata11 = S.optiondata11     , optiontype12    = S.optiontype12, optionvalue12 = S.optionvalue12, optionpercent12 = S.optionpercent12, optiondata12 = S.optiondata12     , optiontype13    = S.optiontype13, optionvalue13 = S.optionvalue13, optionpercent13 = S.optionpercent13, optiondata13 = S.optiondata13     , optiontype14    = S.optiontype14, optionvalue14 = S.optionvalue14, optionpercent14 = S.optionpercent14, optiondata14 = S.optiondata14     , optiontype15    = S.optiontype15, optionvalue15 = S.optionvalue15, optionpercent15 = S.optionpercent15, optiondata15 = S.optiondata15     , optiontype16    = S.optiontype16, optionvalue16 = S.optionvalue16, optionpercent16 = S.optionpercent16, optiondata16 = S.optiondata16     , optiontype17    = S.optiontype17, optionvalue17 = S.optionvalue17, optionpercent17 = S.optionpercent17, optiondata17 = S.optiondata17     , optiontype18    = S.optiontype18, optionvalue18 = S.optionvalue18, optionpercent18 = S.optionpercent18, optiondata18 = S.optiondata18     , optiontype19    = S.optiontype19, optionvalue19 = S.optionvalue19, optionpercent19 = S.optionpercent19, optiondata19 = S.optiondata19         , enchant     = S.enchant     , prePositionWord   = S.prepositionword     , [time]     = S.[time]     , curDurability    = S.curDurability, maxDurability = S.maxDurability     , bindItemCharId   = S.bindItemCharId, isSealedItem = S.isSealedItem, sealcount = S.sealCount     , expirationDate   = S.expirationdate, add_minute  = S.add_minute     , variationIndex   = S.variationIndex     , customItemIndex   = S.customItemIndex, customPrepositionword = S.customPrepositionword, customVariationIndex =  S.customVariationIndex, customArmorIndex = S.customArmorIndex, customWeaponIndex = S.customWeaponIndex     , growExp     = S.growExp     , changedOptionType   = S.changedOptionType, changedOptionSection  = S.changedOptionSection     , additionalOptionGrade  = S.additionalOptionGrade     , additionalOptionIndex0 = S.additionalOptionIndex0, additionalOptiontype0 = S.additionalOptionType0, additionalOptionvalue0 = S.additionalOptionValue0, additionalOptionpercent0 = S.additionalOptionPercent0     , additionalOptionIndex1 = S.additionalOptionIndex1, additionalOptiontype1 = S.additionalOptionType1, additionalOptionvalue1 = S.additionalOptionValue1, additionalOptionpercent1 = S.additionalOptionPercent1     , additionalOptionIndex2 = S.additionalOptionIndex2, additionalOptiontype2 = S.additionalOptionType2, additionalOptionvalue2 = S.additionalOptionValue2, additionalOptionpercent2 = S.additionalOptionPercent2     , transcendItemIndex0  = S.transcendItemIndex0, transcendEnchantCount0 = S.transcendEnchantCount0, transcendEnchantFailCount0 = S.transcendEnchantFailCount0, transcendOptiontype0 = S.transcendOptiontype0     , transcendOptionvalue0  = S.transcendOptionvalue0, transcendOptionpercent0 = S.transcendOptionpercent0     , transcendItemIndex1  = S.transcendItemIndex1, transcendEnchantCount1 = S.transcendEnchantCount1, transcendEnchantFailCount1 = S.transcendEnchantFailCount1, transcendOptiontype1 = S.transcendOptiontype1     , transcendOptionvalue1  = S.transcendOptionvalue1, transcendOptionpercent1 = S.transcendOptionpercent1     , enchantFailCount   = S.enchantFailCount     , optionChangeCount   = S.optionChangeCount     , transcendStoneResetCount  = S.transcendStoneResetCount     , itemRuneMainIndex   = S.itemRuneMainIndex, itemRuneOptionType = S.itemRuneOptionType     , itemRuneOptionValue  = S.itemRuneOptionValue, itemRuneOptionPercent = S.itemRuneOptionPercent     , optionSelectCount0  = S.optionSelectCount0, optionMaxSelectCount0 = S.optionMaxSelectCount0     , optionSelectCount1  = S.optionSelectCount1, optionMaxSelectCount1 = S.optionMaxSelectCount1     , optionSelectCount2  = S.optionSelectCount2, optionMaxSelectCount2 = S.optionMaxSelectCount2     , optionSelectCount3  = S.optionSelectCount3, optionMaxSelectCount3 = S.optionMaxSelectCount3     , optionSelectCount4  = S.optionSelectCount4, optionMaxSelectCount4 = S.optionMaxSelectCount4     , optionSelectCount5  = S.optionSelectCount5, optionMaxSelectCount5 = S.optionMaxSelectCount5     , optionSelectCount6  = S.optionSelectCount6, optionMaxSelectCount6 = S.optionMaxSelectCount6     , optionSelectCount7  = S.optionSelectCount7, optionMaxSelectCount7 = S.optionMaxSelectCount7     , optionSelectCount8  = S.optionSelectCount8, optionMaxSelectCount8 = S.optionMaxSelectCount8     , optionSelectCount9  = S.optionSelectCount9, optionMaxSelectCount9 = S.optionMaxSelectCount9     , optionSelectCount10  = S.optionSelectCount10, optionMaxSelectCount10 = S.optionMaxSelectCount10     , optionSelectCount11  = S.optionSelectCount11, optionMaxSelectCount11 = S.optionMaxSelectCount11     , optionSelectCount12  = S.optionSelectCount12, optionMaxSelectCount12 = S.optionMaxSelectCount12     , optionSelectCount13  = S.optionSelectCount13, optionMaxSelectCount13 = S.optionMaxSelectCount13     , optionSelectCount14  = S.optionSelectCount14, optionMaxSelectCount14 = S.optionMaxSelectCount14     , optionSelectCount15  = S.optionSelectCount15, optionMaxSelectCount15 = S.optionMaxSelectCount15     , optionSelectCount16  = S.optionSelectCount16, optionMaxSelectCount16 = S.optionMaxSelectCount16     , optionSelectCount17  = S.optionSelectCount17, optionMaxSelectCount17 = S.optionMaxSelectCount17     , optionSelectCount18  = S.optionSelectCount18, optionMaxSelectCount18 = S.optionMaxSelectCount18     , optionSelectCount19  = S.optionSelectCount19, optionMaxSelectCount19 = S.optionMaxSelectCount19      OUTPUT       CASE WHEN DELETED.knightageid = 0 AND INSERTED.knightageid != 0 THEN @action_push        WHEN DELETED.knightageid != 0 AND INSERTED.knightageid = 0 THEN @action_pop              ELSE @action_none END     , INSERTED.type     , INSERTED.itemid     , CASE WHEN DELETED.knightageid = 0 AND INSERTED.knightageid != 0 THEN INSERTED.overlap        WHEN DELETED.knightageid != 0 AND INSERTED.knightageid = 0 THEN DELETED.overlap              ELSE 0 END        , CASE WHEN DELETED.knightageid != 0 THEN DELETED.knightageid ELSE INSERTED.knightageid END      INTO  @tblItem_changeOwner(actionType, itemIndex, itemId, affectedOverlap, invokedKnightageid)      FROM dbo.TblItem  T      INNER JOIN       (       SELECT  A.*       FROM @i_baseTable A         LEFT JOIN @tblItem_insUpdate  B  ON A.itemId = B.itemId        WHERE B.itemid IS NULL AND A.JobType = @PROC_UPDATE      ) AS S ON T.itemid = S.itemid       --===============================================================================================   -- 기사단창고 이용내역   --===============================================================================================     -- 기사단과 관계있는 데이타만 @tblItem_withKnightage에 입력   -- 기사단창고에서 삭제/업데이트가 동시에 일어난 데이타 제거(수량 합치기할때 동시에 발생)     INSERT INTO @tblItem_withKnightage   SELECT T.*    FROM @tblItem_changeOwner T    WHERE actionType != @action_none     INSERT INTO @tblItem_withKnightage   SELECT T.*    FROM @tblItem_insUpdate T     LEFT JOIN @tblItem_deleted S ON T.itemIndex = S.itemIndex AND T.affectedOverlap = S.affectedOverlap   WHERE T.actionType != @action_none AND S.itemId IS NULL   UNION ALL    SELECT T.*    FROM @tblItem_deleted T     LEFT JOIN  @tblItem_insUpdate S ON T.itemIndex = S.itemIndex AND T.affectedOverlap = S.affectedOverlap   WHERE T.actionType != @action_none AND S.itemId IS NULL          -- 이용내역 남기기     IF EXISTS ( SELECT * FROM @tblItem_withKnightage )   BEGIN       INSERT INTO dbo.TblItemKnightageStorageHistory       (        invokedKnightageId          , invokedCharId            , invokedDate            , invokedAction        , invokedOverlap          , invokedItemid             , invokedItemIndex           , magicbook             , magicsocketcount           , magicsocket1,magicsocket2, magicsocket3, magicsocket4, magicsocket5       , skillid             , identifyoption       , optiontype0, optionvalue0, optionpercent0, optiondata0, optionSelectCount0, optionMaxSelectCount0, additionalOptionIndex0, additionalOptiontype0, additionalOptionvalue0, additionalOptionpercent0, transcendItemIndex0, transcendEnchantCount0, transcendOptiontype0, transcendOptionvalue0, transcendOptionpercent0         , optiontype1, optionvalue1, optionpercent1, optiondata1, optionSelectCount1, optionMaxSelectCount1, additionalOptionIndex1, additionalOptiontype1, additionalOptionvalue1, additionalOptionpercent1, transcendItemIndex1, transcendEnchantCount1, transcendOptiontype1, transcendOptionvalue1, transcendOptionpercent1              , optiontype2, optionvalue2, optionpercent2, optiondata2, optionSelectCount2, optionMaxSelectCount2, additionalOptionIndex2, additionalOptiontype2, additionalOptionvalue2, additionalOptionpercent2            , optiontype3, optionvalue3, optionpercent3, optiondata3, optionSelectCount3, optionMaxSelectCount3          , optiontype4, optionvalue4, optionpercent4, optiondata4, optionSelectCount4, optionMaxSelectCount4          , optiontype5, optionvalue5, optionpercent5, optiondata5, optionSelectCount5, optionMaxSelectCount5          , optiontype6, optionvalue6, optionpercent6, optiondata6, optionSelectCount6, optionMaxSelectCount6          , optiontype7, optionvalue7, optionpercent7, optiondata7, optionSelectCount7, optionMaxSelectCount7          , optiontype8, optionvalue8, optionpercent8, optiondata8, optionSelectCount8, optionMaxSelectCount8          , optiontype9, optionvalue9, optionpercent9, optiondata9, optionSelectCount9, optionMaxSelectCount9          , optiontype10, optionvalue10, optionpercent10, optiondata10, optionSelectCount10, optionMaxSelectCount10       , optiontype11, optionvalue11, optionpercent11, optiondata11, optionSelectCount11, optionMaxSelectCount11       , optiontype12, optionvalue12, optionpercent12, optiondata12, optionSelectCount12, optionMaxSelectCount12       , optiontype13, optionvalue13, optionpercent13, optiondata13, optionSelectCount13, optionMaxSelectCount13       , optiontype14, optionvalue14, optionpercent14, optiondata14, optionSelectCount14, optionMaxSelectCount14       , optiontype15, optionvalue15, optionpercent15, optiondata15, optionSelectCount15, optionMaxSelectCount15       , optiontype16, optionvalue16, optionpercent16, optiondata16, optionSelectCount16, optionMaxSelectCount16       , optiontype17, optionvalue17, optionpercent17, optiondata17, optionSelectCount17, optionMaxSelectCount17       , optiontype18, optionvalue18, optionpercent18, optiondata18, optionSelectCount18, optionMaxSelectCount18       , optiontype19, optionvalue19, optionpercent19, optiondata19, optionSelectCount19, optionMaxSelectCount19           , enchant             , prepositionword           , [time]       , curdurability            , maxdurability            , issealeditem            , sealcount             , binditemcharid           , expirationdate           , add_minute            , variationindex           , customItemIndex           , customPrepositionword          , customVariationIndex          , customArmorIndex           , customWeaponIndex                , growExp             , changedOptionType           , changedOptionSection          , additionalOptionGrade       , [block]              , enchantFailCount           , transcendEnchantFailCount0        , transcendEnchantFailCount1        , transcendStoneResetCount         , optionChangeCount           , itemRuneMainIndex           , itemRuneOptionType          , itemRuneOptionValue          , itemRuneOptionPercent        )       SELECT         A.invokedKnightageId       , @i_charId  AS invokedCharId       , GETDATE()  AS invokedDate       , A.actionType       , A.affectedOverlap       , A.itemid             , A.itemIndex         , B.magicbook             , B.magicsocketcount       , B.magicsocket1, B.magicsocket2, B.magicsocket3, B.magicsocket4, B.magicsocket5       , B.skillid             , B.identifyoption       , B.optiontype0, B.optionvalue0, B.optionpercent0, B.optiondata0, B.optionSelectCount0, B.optionMaxSelectCount0, B.additionalOptionIndex0, B.additionalOptiontype0, B.additionalOptionvalue0, B.additionalOptionpercent0, B.transcendItemIndex0, B.transcendEnchantCount0, B.transcendOptiontype0, B.transcendOptionvalue0, B.transcendOptionpercent0         , B.optiontype1, B.optionvalue1, B.optionpercent1, B.optiondata1, B.optionSelectCount1, B.optionMaxSelectCount1, B.additionalOptionIndex1, B.additionalOptiontype1, B.additionalOptionvalue1, B.additionalOptionpercent1, B.transcendItemIndex1, B.transcendEnchantCount1, B.transcendOptiontype1, B.transcendOptionvalue1, B.transcendOptionpercent1              , B.optiontype2, B.optionvalue2, B.optionpercent2, B.optiondata2, B.optionSelectCount2, B.optionMaxSelectCount2, B.additionalOptionIndex2, B.additionalOptiontype2, B.additionalOptionvalue2, B.additionalOptionpercent2            , B.optiontype3, B.optionvalue3, B.optionpercent3, B.optiondata3, B.optionSelectCount3, B.optionMaxSelectCount3          , B.optiontype4, B.optionvalue4, B.optionpercent4, B.optiondata4, B.optionSelectCount4, B.optionMaxSelectCount4          , B.optiontype5, B.optionvalue5, B.optionpercent5, B.optiondata5, B.optionSelectCount5, B.optionMaxSelectCount5          , B.optiontype6, B.optionvalue6, B.optionpercent6, B.optiondata6, B.optionSelectCount6, B.optionMaxSelectCount6          , B.optiontype7, B.optionvalue7, B.optionpercent7, B.optiondata7, B.optionSelectCount7, B.optionMaxSelectCount7          , B.optiontype8, B.optionvalue8, B.optionpercent8, B.optiondata8, B.optionSelectCount8, B.optionMaxSelectCount8          , B.optiontype9, B.optionvalue9, B.optionpercent9, B.optiondata9, B.optionSelectCount9, B.optionMaxSelectCount9          , B.optiontype10, B.optionvalue10, B.optionpercent10, B.optiondata10, B.optionSelectCount10, B.optionMaxSelectCount10       , B.optiontype11, B.optionvalue11, B.optionpercent11, B.optiondata11, B.optionSelectCount11, B.optionMaxSelectCount11       , B.optiontype12, B.optionvalue12, B.optionpercent12, B.optiondata12, B.optionSelectCount12, B.optionMaxSelectCount12          , B.optiontype13, B.optionvalue13, B.optionpercent13, B.optiondata13, B.optionSelectCount13, B.optionMaxSelectCount13          , B.optiontype14, B.optionvalue14, B.optionpercent14, B.optiondata14, B.optionSelectCount14, B.optionMaxSelectCount14          , B.optiontype15, B.optionvalue15, B.optionpercent15, B.optiondata15, B.optionSelectCount15, B.optionMaxSelectCount15          , B.optiontype16, B.optionvalue16, B.optionpercent16, B.optiondata16, B.optionSelectCount16, B.optionMaxSelectCount16          , B.optiontype17, B.optionvalue17, B.optionpercent17, B.optiondata17, B.optionSelectCount17, B.optionMaxSelectCount17          , B.optiontype18, B.optionvalue18, B.optionpercent18, B.optiondata18, B.optionSelectCount18, B.optionMaxSelectCount18          , B.optiontype19, B.optionvalue19, B.optionpercent19, B.optiondata19, B.optionSelectCount19, B.optionMaxSelectCount19              , B.enchant             , B.prepositionword           , B.[time]              , B.curdurability            , B.maxdurability            , B.issealeditem            , B.sealcount             , B.binditemcharid           , B.expirationdate           , B.add_minute            , B.variationindex           , B.customItemIndex           , B.customPrepositionword          , B.customVariationIndex          , B.customArmorIndex           , B.customWeaponIndex         , B.growExp             , B.changedOptionType           , B.changedOptionSection          , B.additionalOptionGrade           , 0 AS [block]              , B.enchantFailCount           , B.transcendEnchantFailCount0        , B.transcendEnchantFailCount1        , B.transcendStoneResetCount         , B.optionChangeCount           , B.itemRuneMainIndex           , B.itemRuneOptionType          , B.itemRuneOptionValue          , B.itemRuneOptionPercent       FROM @tblItem_withKnightage A       LEFT JOIN @i_baseTable B ON A.itemId = B.itemid   END       RETURN 0    END    /******************************************************************************  ** Name : [UspItemTranscation]  ** Desc :     ** Exec :     ** Auth :   ** Date :   *******************************************************************************  ** Change History  *******************************************************************************  ** Date:  Author:  Description:  ** -------- -------- ---------------------------------------   2018-09-18 이화영  신규 생성 tvp를 활용하여 한번에 아이템 작업을 처리 하도록 개선.   2018-10-17 정광진  기사단 창고 이용내역 기록  *******************************************************************************/
